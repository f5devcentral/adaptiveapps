{
  "class": "ADC",
  "schemaVersion": "3.0.0",
  "Common": {
    "class": "Tenant",
    "Shared": {
      "class": "Application",
      "template": "shared",
      "appTelemetryIRule": {
        "class": "iRule",
        "iRule": {
          "base64": "d2hlbiBSVUxFX0lOSVQgewogICAgc2V0IHN0YXRpYzo6bWV0cmljX3RhYmxlX25hbWUgdHJhZmZpY19kYXRhCiAgICBzZXQgc3RhdGljOjpwdWJsaXNoZXIgIi9Db21tb24vU2hhcmVkL3RlbGVtZXRyeV9wdWJsaXNoZXIiCgogICAgIyBTaG9ydGVzdCBpbnRlcnZhbCAoaW4gc2Vjb25kcykgdG8gbG9nIGEgbWVzc2FnZQogICAgc2V0IHN0YXRpYzo6bWluX2xvZ19pbnRlcnZhbCAxMAogICAgc2V0IHN0YXRpYzo6bGFzdF9sb2dfa2V5ICJsYXN0X2xvZ190aW1lc3RhbXAiCgogICAgc2V0IHN0YXRpYzo6ZW5hYmxlX2dlb2lwX2RhdGEgMQogICAgc2V0IHN0YXRpYzo6aW52YWxpZF9jb3VudHJ5X2NvZGUgIlpaIgp9CndoZW4gSFRUUF9SRVNQT05TRSB7CiAgICBzZXQga2V5ICJbdmlydHVhbF0iCgogICAgIyBHYXRoZXIgbG9jYXRpb24gZGF0YQogICAgaWYge1tleHByIHskc3RhdGljOjplbmFibGVfZ2VvaXBfZGF0YSA9PSAxfV19IHsKICAgICAgICBzZXQgaXBhZGRyIFtJUDo6Y2xpZW50X2FkZHJdCiAgICAgICAgc2V0IGNvdW50cnkgW3doZXJlaXMgJGlwYWRkciBjb3VudHJ5XQogICAgICAgIGlmIHtbZXhwciB7JGNvdW50cnkgZXEgIiJ9XX0gewogICAgICAgICAgICBzZXQgY291bnRyeSAkc3RhdGljOjppbnZhbGlkX2NvdW50cnlfY29kZQogICAgICAgIH0KICAgICAgICBzZXQga2V5ICIka2V5OiRjb3VudHJ5IgogICAgfQoKICAgIHRhYmxlIGFwcGVuZCAtc3VidGFibGUgJHN0YXRpYzo6bWV0cmljX3RhYmxlX25hbWUgJGtleSAiIFtleHByIHtbVENQOjpydHRdIC8gMzIuMH1dIjsKCiAgICBzZXQgbGFzdGxvZyBbdGFibGUgbG9va3VwICRzdGF0aWM6Omxhc3RfbG9nX2tleV0KICAgIHNldCBub3cgW2Nsb2NrIHNlY29uZHNdCiAgICBpZiB7ICRsYXN0bG9nIGVxdWFscyAiIiB9IHsKICAgICAgICAjIFRoaXMgaXMgdGhlIGZpcnN0IGV4ZWN1dGlvbiBzbyBjcmVhdGUgdGhlIHRhYmxlIGVudHJ5IGFuZCBmb3JjZSBhIGxvZyBhdHRlbXB0CiAgICAgICAgdGFibGUgYWRkICRzdGF0aWM6Omxhc3RfbG9nX2tleSAkbm93CiAgICAgICAgc2V0IGxhc3Rsb2cgMAogICAgfQoKICAgICMgT25seSBzZW5kIGRhdGEgb24gYSBkZWZpbmVkIGludGVydmFsCiAgICBpZiB7W2V4cHIgeyAoJG5vdyAtICRsYXN0bG9nKSA+ICRzdGF0aWM6Om1pbl9sb2dfaW50ZXJ2YWwgfV19IHsKICAgICAgICAjIE9wZW4gYSBjb25uZWN0aW9uIHRvIGEgUHVibGlzaGVyCiAgICAgICAgc2V0IGhzbCBbSFNMOjpvcGVuIC1wdWJsaXNoZXIgJHN0YXRpYzo6cHVibGlzaGVyXQogICAgICAgICMgSXRlcmF0ZSB0aHJvdWdoIGVhY2ggYXBwbGljYXRpb24KICAgICAgICBmb3JlYWNoIGtleSBbdGFibGUga2V5cyAtc3VidGFibGUgJHN0YXRpYzo6bWV0cmljX3RhYmxlX25hbWVdIHsKCiAgICAgICAgICAgIHNldCBrZXlfcGFydHMgW3NwbGl0ICRrZXkgOl0KICAgICAgICAgICAgc2V0IGFwcGxpY2F0aW9uIFtsaW5kZXggJGtleV9wYXJ0cyAwXQogICAgICAgICAgICBzZXQgY291bnRyeSBbbGluZGV4ICRrZXlfcGFydHMgMV0KCiAgICAgICAgICAgIHNldCB2YWx1ZXMgW3RhYmxlIGxvb2t1cCAtc3VidGFibGUgJHN0YXRpYzo6bWV0cmljX3RhYmxlX25hbWUgJGtleV0KICAgICAgICAgICAgIyBHYXRoZXIgcmVzcG9uc2UgdGltZSBtZXRyaWNzCiAgICAgICAgICAgIHNldCBtYXggMAogICAgICAgICAgICBzZXQgbWluIGluZGVmCiAgICAgICAgICAgIHNldCB0b3RhbCAwLjAKICAgICAgICAgICAgc2V0IGNvdW50IDAKICAgICAgICAgICAgZm9yZWFjaCB2YWx1ZSAkdmFsdWVzIHsKICAgICAgICAgICAgICAgIGlmIHtbZXhwciB7JHZhbHVlID4gJG1heH1dfXsKICAgICAgICAgICAgICAgICAgICBzZXQgbWF4ICR2YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYge1tleHByIHskdmFsdWUgPCAkbWlufV19ewogICAgICAgICAgICAgICAgICAgIHNldCBtaW4gJHZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXQgdG90YWwgW2V4cHIgeyR0b3RhbCArICR2YWx1ZX1dCiAgICAgICAgICAgICAgICBpbmNyIGNvdW50IDEKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYge1tleHByIHskY291bnQgPT0gMH1dfSB7CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB9CgogICAgICAgICAgICBzZXQgYXZnIFtleHByIHskdG90YWwgLyAkY291bnR9XQoKICAgICAgICAgICAgIyBQcmVwYXJlIGRhdGEgaW4gSlNPTiBmb3JtYXQKICAgICAgICAgICAgc2V0IGRhdGEgYXBwbGljYXRpb249XCIkYXBwbGljYXRpb25cIixydHRUaW1lTWluPVwiJG1pblwiLHJ0dFRpbWVNYXg9XCIkbWF4XCIscnR0VGltZUF2Zz1cIiRhdmdcIgogICAgICAgICAgICBpZiB7W2V4cHIgeyRzdGF0aWM6OmVuYWJsZV9nZW9pcF9kYXRhID09IDF9XX0gewogICAgICAgICAgICAgICAgc2V0IGRhdGEgIiRkYXRhLGNvdW50cnk9XCIkY291bnRyeVwiIgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIFNlbmQgZGF0YSB0byBhIFB1Ymxpc2hlcgogICAgICAgICAgICBzZXQgc2VuZF9yZXN1bHQgW0hTTDo6c2VuZCAke2hzbH0gIiR7ZGF0YX0iXQogICAgICAgICAgICBpZiB7W2V4cHIgeyRzZW5kX3Jlc3VsdCA9PSAwfV19IHsKICAgICAgICAgICAgICAgIGxvZyBsb2NhbDAuICJGYWlsZWQgdG8gc2VuZCBkYXRhIHRvICRzdGF0aWM6OnB1Ymxpc2hlciwgcGxlYXNlIGVuc3VyZSB0aGF0IGl0IGlzIG5vdCB1c2luZyBhIGZvcm1hdHRlZCBkZXN0aW5hdGlvbi4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGFibGUgcmVwbGFjZSAkc3RhdGljOjpsYXN0X2xvZ19rZXkgJG5vdwogICAgICAgIHRhYmxlIGRlbGV0ZSAtc3VidGFibGUgJHN0YXRpYzo6bWV0cmljX3RhYmxlX25hbWUgLWFsbAogICAgfQp9Cg=="
        }
      },
      "telemetryStreamingIRule": {
        "class": "iRule",
        "iRule": "when CLIENT_ACCEPTED {\n  node 127.0.0.1 6514\n}"
      },
      "telemetryStreamingService": {
        "class": "Service_TCP",
        "virtualAddresses": [
          "255.255.255.254"
        ],
        "virtualPort": 6514,
        "iRules": [
          "telemetryStreamingIRule"
        ]
      },
      "telemetryStreamingPool": {
        "class": "Pool",
        "members": [
          {
            "serverAddresses": [
              "255.255.255.254"
            ],
            "servicePort": 6514
          }
        ]
      },
      "telemetryStreamingLogDestination": {
        "class": "Log_Destination",
        "type": "remote-high-speed-log",
        "protocol": "tcp",
        "pool": {
          "use": "telemetryStreamingPool"
        }
      },
      "telemetryStreamingLogPublisher": {
        "class": "Log_Publisher",
        "destinations": [
          {
            "use": "telemetryStreamingLogDestination"
          }
        ]
      }
    }
  }
}
